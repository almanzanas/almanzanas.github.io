<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Alvaro Manzanas - 7&nbsp; Transformations with Tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../_book-lib-dir/quarto-nav/quarto-nav.js"></script>
<script src="../../_book-lib-dir/clipboard/clipboard.min.js"></script>
<script src="../../_book-lib-dir/quarto-search/autocomplete.umd.js"></script>
<script src="../../_book-lib-dir/quarto-search/fuse.min.js"></script>
<script src="../../_book-lib-dir/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../to_book/notebooks/12_ExpDatAn.html" rel="next">
<link href="../../to_book/notebooks/99_summary.html" rel="prev">
<script src="../../_book-lib-dir/quarto-html/quarto.js"></script>
<script src="../../_book-lib-dir/quarto-html/popper.min.js"></script>
<script src="../../_book-lib-dir/quarto-html/tippy.umd.min.js"></script>
<script src="../../_book-lib-dir/quarto-html/anchor.min.js"></script>
<link href="../../_book-lib-dir/quarto-html/tippy.css" rel="stylesheet">
<link href="../../_book-lib-dir/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../_book-lib-dir/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../_book-lib-dir/bootstrap/bootstrap.min.js"></script>
<link href="../../_book-lib-dir/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../_book-lib-dir/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../_book-lib-dir/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Alvaro Manzanas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../index.html" aria-current="page"> 
<span class="menu-text">Annotations</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="../../docs/Alvaro Manzanas-CV_es.pdf" target="_blank">
 <span class="dropdown-text">Spanish</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/Alvaro Manzanas-CV_en.pdf" target="_blank">
 <span class="dropdown-text">English</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="http://github.com/almanzanas" target="_blank"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:almanzanas@gmx.com"> <i class="bi bi-bi bi-envelope" role="img" aria-label="e-mail">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://es.linkedin.com/in/alvaromanzanas" target="_blank"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../to_book/notebooks/11_transformations_tidyverse.html">Data Wrangling and Model</a></li><li class="breadcrumb-item"><a href="../../to_book/notebooks/11_transformations_tidyverse.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transformations with Tidyverse</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main tools-wide">
    <a href="http://github.com/almanzanas" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:almanzanas@gmx.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bi bi-envelope"></i></a>
    <a href="https://es.linkedin.com/in/alvaromanzanas" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Annotations</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Base R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/00_basics_ndata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R: The very basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/01_functions_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Functions, scripts and performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/02_data_into_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/03_data_handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data Handling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/99_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Base-R Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Wrangling and Model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/11_transformations_tidyverse.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transformations with Tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/12_ExpDatAn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/13_enchanced_visualizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Enchanced Visualizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/14_modeling2deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Modeling to Deploy</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#slicing-and-filtering" id="toc-slicing-and-filtering" class="nav-link active" data-scroll-target="#slicing-and-filtering"><span class="header-section-number">8</span> Slicing and filtering</a>
  <ul class="collapse">
  <li><a href="#filtering" id="toc-filtering" class="nav-link" data-scroll-target="#filtering"><span class="header-section-number">8.1</span> Filtering</a></li>
  </ul></li>
  <li><a href="#grouping-and-summarizing-data" id="toc-grouping-and-summarizing-data" class="nav-link" data-scroll-target="#grouping-and-summarizing-data"><span class="header-section-number">9</span> Grouping and summarizing data</a></li>
  <li><a href="#replacing-and-filling-data" id="toc-replacing-and-filling-data" class="nav-link" data-scroll-target="#replacing-and-filling-data"><span class="header-section-number">10</span> Replacing and Filling Data</a></li>
  <li><a href="#arranging-data" id="toc-arranging-data" class="nav-link" data-scroll-target="#arranging-data"><span class="header-section-number">11</span> Arranging data</a></li>
  <li><a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables"><span class="header-section-number">12</span> Creating new variables</a>
  <ul class="collapse">
  <li><a href="#the-mutate-function" id="toc-the-mutate-function" class="nav-link" data-scroll-target="#the-mutate-function"><span class="header-section-number">12.1</span> The <code>mutate()</code> function</a></li>
  </ul></li>
  <li><a href="#joining-datasets" id="toc-joining-datasets" class="nav-link" data-scroll-target="#joining-datasets"><span class="header-section-number">13</span> Joining datasets</a></li>
  <li><a href="#reshaping-a-table" id="toc-reshaping-a-table" class="nav-link" data-scroll-target="#reshaping-a-table"><span class="header-section-number">14</span> Reshaping a table</a></li>
  <li><a href="#interesting-tidyverse-functions" id="toc-interesting-tidyverse-functions" class="nav-link" data-scroll-target="#interesting-tidyverse-functions"><span class="header-section-number">15</span> Interesting Tidyverse functions</a>
  <ul class="collapse">
  <li><a href="#ggplot2" id="toc-ggplot2" class="nav-link" data-scroll-target="#ggplot2"><span class="header-section-number">15.1</span> <code>ggplot2</code></a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../to_book/notebooks/11_transformations_tidyverse.html">Data Wrangling and Model</a></li><li class="breadcrumb-item"><a href="../../to_book/notebooks/11_transformations_tidyverse.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transformations with Tidyverse</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Transformations with Tidyverse</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Dataset: https://archive.ics.uci.edu/ml/datasets/Adult</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">#install.packages('tidyverse')</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.1     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<p>Tidy data is one observation per row, one measurement or variable per column and one value per cell.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>header <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"age"</span>, <span class="st">"workclass"</span>, <span class="st">"fnlwgt"</span>,<span class="st">"education"</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="st">"education_num"</span>, <span class="st">"marital_status"</span>, <span class="st">"occupation"</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="st">"relationship"</span>, <span class="st">"race"</span>, <span class="st">"sex"</span>, <span class="st">"capital_gain"</span>, <span class="st">"capital_loss"</span>,<span class="st">"hours_per_week"</span>, <span class="st">"native_country"</span>, <span class="st">"target"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"https://archive.ics.uci.edu/ml/machine-learning-databases/adult/adult.data"</span>, <span class="at">col_names =</span> header, </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">trim_ws =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 32561 Columns: 15
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (9): workclass, education, marital_status, occupation, relationship, rac...
dbl (6): age, fnlwgt, education_num, capital_gain, capital_loss, hours_per_week

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 15
    age workclass       fnlwgt education education_num marital_status occupation
  &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     
1    39 State-gov        77516 Bachelors            13 Never-married  Adm-cleri…
2    50 Self-emp-not-i…  83311 Bachelors            13 Married-civ-s… Exec-mana…
3    38 Private         215646 HS-grad               9 Divorced       Handlers-…
4    53 Private         234721 11th                  7 Married-civ-s… Handlers-…
5    28 Private         338409 Bachelors            13 Married-civ-s… Prof-spec…
6    37 Private         284582 Masters              14 Married-civ-s… Exec-mana…
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<section id="slicing-and-filtering" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Slicing and filtering</h1>
<p>The basic form of dplyr for slicing it to use a <code>.</code> to consider everything from the object that precedes it. The returned object will be a tibble.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> .[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  workclass        fnlwgt education education_num
  &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1 State-gov         77516 Bachelors            13
2 Self-emp-not-inc  83311 Bachelors            13
3 Private          215646 HS-grad               9
4 Private          234721 11th                  7</code></pre>
</div>
</div>
<ul>
<li><code>slice_min(), slice_max()</code>: to fetch the top or bottom observation given a percentage.</li>
<li><code>slice_sample()</code>: to extract a sample.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">slice_min</span>(age, <span class="at">prop =</span> <span class="fl">0.15</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5,570 × 15
     age workclass fnlwgt education education_num marital_status occupation     
   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;          
 1    17 ?         304873 10th                  6 Never-married  ?              
 2    17 Private    65368 11th                  7 Never-married  Sales          
 3    17 Private   245918 11th                  7 Never-married  Other-service  
 4    17 Private   191260 9th                   5 Never-married  Other-service  
 5    17 Private   270942 5th-6th               3 Never-married  Other-service  
 6    17 Private    89821 11th                  7 Never-married  Other-service  
 7    17 Private   175024 11th                  7 Never-married  Handlers-clean…
 8    17 ?         202521 11th                  7 Never-married  ?              
 9    17 ?         258872 11th                  7 Never-married  ?              
10    17 Private   211870 9th                   5 Never-married  Other-service  
# ℹ 5,560 more rows
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>, <span class="at">replace =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span> .[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
     age workclass        fnlwgt education   
   &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;       
 1    34 Local-gov        205704 Masters     
 2    36 ?                176458 HS-grad     
 3    43 Private          233851 Bachelors   
 4    79 Self-emp-not-inc 103684 HS-grad     
 5    48 Private           70209 Some-college
 6    36 Private           93225 Bachelors   
 7    31 Private          212235 Some-college
 8    39 Private          325374 Some-college
 9    36 Private          110998 Masters     
10    44 Private          151294 Some-college</code></pre>
</div>
</div>
<section id="filtering" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="filtering"><span class="header-section-number">8.1</span> Filtering</h2>
<ul>
<li><code>filter()</code>: returns rows given a condition.</li>
<li><code>select()</code>: to choose variable to show in the given order.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>( age <span class="sc">&lt;</span> <span class="dv">30</span> ) <span class="sc">%&gt;%</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>( marital_status, age, education ) <span class="sc">%&gt;%</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>( <span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
   marital_status       age education   
   &lt;chr&gt;              &lt;dbl&gt; &lt;chr&gt;       
 1 Married-civ-spouse    26 HS-grad     
 2 Never-married         19 HS-grad     
 3 Never-married         21 HS-grad     
 4 Married-civ-spouse    29 HS-grad     
 5 Never-married         26 Some-college
 6 Never-married         25 Bachelors   
 7 Married-civ-spouse    27 Bachelors   
 8 Never-married         27 HS-grad     
 9 Never-married         21 HS-grad     
10 Never-married         29 HS-grad     </code></pre>
</div>
</div>
<ul>
<li>distinct(): to extract unique values.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(sex) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 1
  sex   
  &lt;chr&gt; 
1 Male  
2 Female</code></pre>
</div>
</div>
</section>
</section>
<section id="grouping-and-summarizing-data" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> Grouping and summarizing data</h1>
<p>The next functions are complementary, usually used together.</p>
<ul>
<li><code>group_by()</code>: to group a variable by its values</li>
<li><code>summarize()</code>: given a function with a variable returns the result.</li>
<li><code>ungroup()</code>: after <code>group_by()</code> with more than one variable, it returns a <code>tbl_df</code>. The ungrouped tibble requires less memory space than the tibble one.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(workclass) <span class="sc">%&gt;%</span> .[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
# Groups:   workclass [3]
     age workclass        fnlwgt education
   &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;    
 1    39 State-gov         77516 Bachelors
 2    50 Self-emp-not-inc  83311 Bachelors
 3    38 Private          215646 HS-grad  
 4    53 Private          234721 11th     
 5    28 Private          338409 Bachelors
 6    37 Private          284582 Masters  
 7    49 Private          160187 9th      
 8    52 Self-emp-not-inc 209642 HS-grad  
 9    31 Private           45781 Masters  
10    42 Private          159449 Bachelors</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">avg_age =</span> <span class="fu">mean</span>(age), <span class="at">sd_age =</span> <span class="fu">sd</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  sex    avg_age sd_age
  &lt;chr&gt;    &lt;dbl&gt;  &lt;dbl&gt;
1 Female    36.9   14.0
2 Male      39.4   13.4</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>marital.groups <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(marital_status, sex) <span class="sc">%&gt;%</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">avg_age =</span> <span class="fu">mean</span>(age) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'marital_status'. You can override using
the `.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>marital.groups</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
# Groups:   marital_status [7]
   marital_status        sex    avg_age
   &lt;chr&gt;                 &lt;chr&gt;    &lt;dbl&gt;
 1 Divorced              Female    43.3
 2 Divorced              Male      42.7
 3 Married-AF-spouse     Female    33.1
 4 Married-AF-spouse     Male      31.4
 5 Married-civ-spouse    Female    39.5
 6 Married-civ-spouse    Male      43.7
 7 Married-spouse-absent Female    39.6
 8 Married-spouse-absent Male      41.6
 9 Never-married         Female    28.1
10 Never-married         Male      28.2
11 Separated             Female    39.6
12 Separated             Male      39.0
13 Widowed               Female    58.4
14 Widowed               Male      61.7</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ungroup</span>(marital.groups)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 3
   marital_status        sex    avg_age
   &lt;chr&gt;                 &lt;chr&gt;    &lt;dbl&gt;
 1 Divorced              Female    43.3
 2 Divorced              Male      42.7
 3 Married-AF-spouse     Female    33.1
 4 Married-AF-spouse     Male      31.4
 5 Married-civ-spouse    Female    39.5
 6 Married-civ-spouse    Male      43.7
 7 Married-spouse-absent Female    39.6
 8 Married-spouse-absent Male      41.6
 9 Never-married         Female    28.1
10 Never-married         Male      28.2
11 Separated             Female    39.6
12 Separated             Male      39.0
13 Widowed               Female    58.4
14 Widowed               Male      61.7</code></pre>
</div>
</div>
<ul>
<li><code>quantile()</code>: returns the number corresponding the passing percentage.</li>
<li><code>first()</code>: returns the first number. Combined with <code>group_by()</code> returns the first number of each group.</li>
<li><code>across()</code>: applies a function to the selected columns.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(marital_status) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="fu">first</span>(age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 2
  marital_status        `first(age)`
  &lt;chr&gt;                        &lt;dbl&gt;
1 Divorced                        38
2 Married-AF-spouse               19
3 Married-civ-spouse              50
4 Married-spouse-absent           49
5 Never-married                   39
6 Separated                       54
7 Widowed                         36</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="st">"50%"</span> <span class="ot">=</span> <span class="fu">quantile</span>(age, <span class="fl">0.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  sex    `50%`
  &lt;chr&gt;  &lt;dbl&gt;
1 Female    35
2 Male      38</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>( <span class="fu">across</span>(<span class="fu">everything</span>(), mean) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 6
    age  fnlwgt education_num capital_gain capital_loss hours_per_week
  &lt;dbl&gt;   &lt;dbl&gt;         &lt;dbl&gt;        &lt;dbl&gt;        &lt;dbl&gt;          &lt;dbl&gt;
1  38.6 189778.          10.1        1078.         87.3           40.4</code></pre>
</div>
</div>
</section>
<section id="replacing-and-filling-data" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> Replacing and Filling Data</h1>
<p>A dataset will be imperfect, in this case we have ‘?’ instead of NA. First, the character ‘?’ has to be replaced with NA and then we can replace NA with other character.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="cf">in</span> <span class="fu">colnames</span>(df) ) {</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span> (var, <span class="fu">nrow</span>( df[df[var] <span class="sc">==</span> <span class="st">'?'</span>, ] ) )</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "age 0"
[1] "workclass 1836"
[1] "fnlwgt 0"
[1] "education 0"
[1] "education_num 0"
[1] "marital_status 0"
[1] "occupation 1843"
[1] "relationship 0"
[1] "race 0"
[1] "sex 0"
[1] "capital_gain 0"
[1] "capital_loss 0"
[1] "hours_per_week 0"
[1] "native_country 583"
[1] "target 0"</code></pre>
</div>
</div>
<p>In the output we can see the missing values represented with ‘?’: “workclass 1836”, “occupation 1843”, and “native_country 583”. Now we can use <code>mutate()</code> to edit the columns affected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df.rep <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> (<span class="at">workclass =</span> <span class="fu">replace</span>(workclass, workclass <span class="sc">==</span> <span class="st">'?'</span>, <span class="cn">NA</span>),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">occupation =</span> <span class="fu">replace</span>(occupation, occupation <span class="sc">==</span> <span class="st">'?'</span>, <span class="cn">NA</span>),</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">native_country =</span> <span class="fu">replace</span>(native_country, native_country <span class="sc">==</span> <span class="st">'?'</span>, <span class="cn">NA</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>( df.rep[<span class="fu">which</span>(<span class="fu">is.na</span>(df.rep[<span class="st">"workclass"</span>])),], <span class="at">n=</span><span class="dv">10</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 15
     age workclass fnlwgt education    education_num marital_status   occupation
   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;     
 1    40 &lt;NA&gt;      351161 Masters                 14 Married-civ-spo… &lt;NA&gt;      
 2    49 &lt;NA&gt;      481987 HS-grad                  9 Married-civ-spo… &lt;NA&gt;      
 3    77 &lt;NA&gt;      147284 HS-grad                  9 Widowed          &lt;NA&gt;      
 4    55 &lt;NA&gt;      487411 Masters                 14 Married-civ-spo… &lt;NA&gt;      
 5    22 &lt;NA&gt;      224238 Some-college            10 Never-married    &lt;NA&gt;      
 6    63 &lt;NA&gt;      170529 Bachelors               13 Married-civ-spo… &lt;NA&gt;      
 7    28 &lt;NA&gt;      198393 HS-grad                  9 Never-married    &lt;NA&gt;      
 8    65 &lt;NA&gt;       37170 7th-8th                  4 Married-civ-spo… &lt;NA&gt;      
 9    74 &lt;NA&gt;       33114 10th                     6 Married-civ-spo… &lt;NA&gt;      
10    60 &lt;NA&gt;      174073 HS-grad                  9 Married-civ-spo… &lt;NA&gt;      
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<p>One alternative can be to use <code>across(everything())</code> to replace with <code>ifelse()</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>df.rep <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>( <span class="fu">across</span>( <span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>( . <span class="sc">==</span> <span class="st">'?'</span>, <span class="cn">NA</span>, . ) ) )</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>df.rep[<span class="fu">which</span>(<span class="fu">is.na</span>(df.rep[<span class="st">"workclass"</span>])),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,836 × 15
     age workclass fnlwgt education    education_num marital_status   occupation
   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;     
 1    54 &lt;NA&gt;      180211 Some-college            10 Married-civ-spo… &lt;NA&gt;      
 2    32 &lt;NA&gt;      293936 7th-8th                  4 Married-spouse-… &lt;NA&gt;      
 3    25 &lt;NA&gt;      200681 Some-college            10 Never-married    &lt;NA&gt;      
 4    67 &lt;NA&gt;      212759 10th                     6 Married-civ-spo… &lt;NA&gt;      
 5    17 &lt;NA&gt;      304873 10th                     6 Never-married    &lt;NA&gt;      
 6    35 &lt;NA&gt;      129305 HS-grad                  9 Married-civ-spo… &lt;NA&gt;      
 7    43 &lt;NA&gt;      174662 Some-college            10 Divorced         &lt;NA&gt;      
 8    52 &lt;NA&gt;      252903 HS-grad                  9 Divorced         &lt;NA&gt;      
 9    68 &lt;NA&gt;       38317 1st-4th                  2 Divorced         &lt;NA&gt;      
10    53 &lt;NA&gt;      135105 Bachelors               13 Divorced         &lt;NA&gt;      
# ℹ 1,826 more rows
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<p>To handle missing values we can drop them, filling them with the previous or next valid value, or replacing them with a statistic value, such as the mean value.</p>
<ul>
<li><code>fill()</code>: Fills missing values in selected columns using the next or previous entry.
<ul>
<li><code>.direction=</code> to choose the direction of the fill (down, up, downup, updown).</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df.rep.na.ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">is.na</span>(df.rep[<span class="st">"occupation"</span>]))</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>df.rep <span class="sc">%&gt;%</span> <span class="fu">fill</span> (workclass, occupation, native_country,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">.direction =</span> <span class="st">"down"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>    .[df.rep.na.ind,] <span class="sc">%&gt;%</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 15
     age workclass      fnlwgt education education_num marital_status occupation
   &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt;     
 1    49 Private        261059 10th                  6 Separated      Handlers-…
 2    38 Private        155676 HS-grad               9 Divorced       Prof-spec…
 3    33 Private        335625 Some-col…            10 Divorced       Adm-cleri…
 4    50 Private        222381 Some-col…            10 Divorced       Craft-rep…
 5    30 Self-emp-not-… 164940 HS-grad               9 Separated      Craft-rep…
 6    65 Private         79272 Some-col…            10 Widowed        Craft-rep…
 7    35 Federal-gov     35854 Some-col…            10 Never-married  Exec-mana…
 8    63 Private         54851 HS-grad               9 Married-civ-s… Farming-f…
 9    33 Private        160776 Assoc-voc            11 Divorced       Other-ser…
10    23 Private         32897 Assoc-ac…            12 Married-civ-s… Sales     
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<p>When the variable is categorical it is common to replace the missing values with the most common category.</p>
<blockquote class="blockquote">
<p>Every change in a dataset is a decision that the data scientist has to make and <b>it will certainly affect the result</b></p>
</blockquote>
<p>This is how we can replace NA with the most frequent value on the categorical variables. First we have to found that value using <code>table()</code> with <code>which.max()</code>. Then we can use that to replace NA with <code>replace_na()</code> pointing both columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most frequent value</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>m.f.workcls <span class="ot">&lt;-</span> <span class="fu">names</span>( <span class="fu">table</span>(df<span class="sc">$</span>workclass)[<span class="fu">which.max</span>(<span class="fu">table</span>(df<span class="sc">$</span>workclass))])</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>m.f.occp <span class="ot">&lt;-</span> <span class="fu">names</span>( <span class="fu">table</span>(df<span class="sc">$</span>occupation)[<span class="fu">which.max</span>(<span class="fu">table</span>(df<span class="sc">$</span>occupation))])</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing NA</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="ot">&lt;-</span> df.rep <span class="sc">%&gt;%</span> <span class="fu">replace_na</span>( <span class="fu">list</span>( <span class="at">workclass =</span> m.f.workcls,</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">occupation =</span> m.f.occp) )</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="fu">slice_sample</span>( df.no.na[df.rep.na.ind,], <span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 15
     age workclass fnlwgt education    education_num marital_status   occupation
   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;     
 1    71 Private   178295 Assoc-acdm              12 Married-civ-spo… Prof-spec…
 2    64 Private   108082 Some-college            10 Married-civ-spo… Prof-spec…
 3    22 Private    42004 Some-college            10 Never-married    Prof-spec…
 4    19 Private    57329 Some-college            10 Never-married    Prof-spec…
 5    71 Private   176986 HS-grad                  9 Widowed          Prof-spec…
 6    18 Private   379768 HS-grad                  9 Never-married    Prof-spec…
 7    20 Private   163911 Some-college            10 Never-married    Prof-spec…
 8    26 Private   188343 HS-grad                  9 Never-married    Prof-spec…
 9    20 Private   287681 Some-college            10 Never-married    Prof-spec…
10    67 Private   274451 7th-8th                  4 Married-civ-spo… Prof-spec…
# ℹ 8 more variables: relationship &lt;chr&gt;, race &lt;chr&gt;, sex &lt;chr&gt;,
#   capital_gain &lt;dbl&gt;, capital_loss &lt;dbl&gt;, hours_per_week &lt;dbl&gt;,
#   native_country &lt;chr&gt;, target &lt;chr&gt;</code></pre>
</div>
</div>
<p>At this point, the data frame only have NA values in native_country. If the NA is less than 5% of the total observation we could drop that observations. With ‘workclass’ and ‘occupation’ this percentage was bigger than 5% but on ‘native_country’ is less than 2%.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop NA</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="ot">&lt;-</span> df.no.na <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Example to extract NA percentage:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get proportions with table()</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df.rep<span class="sc">$</span>occupation, <span class="at">useNA =</span> <span class="st">'ifany'</span>) <span class="sc">%&gt;%</span> <span class="fu">prop.table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Adm-clerical      Armed-Forces      Craft-repair   Exec-managerial 
     0.1157826848      0.0002764043      0.1258867971      0.1248733147 
  Farming-fishing Handlers-cleaners Machine-op-inspct     Other-service 
     0.0305273180      0.0420748749      0.0614845981      0.1011946808 
  Priv-house-serv    Prof-specialty   Protective-serv             Sales 
     0.0045760265      0.1271459722      0.0199318203      0.1120972943 
     Tech-support  Transport-moving              &lt;NA&gt; 
     0.0285003532      0.0490464052      0.0566014557 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic alternative</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">"NA percentage on 'occupation' variable: "</span>,</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(<span class="fu">is.na</span>(df.rep<span class="sc">$</span>occupation)) <span class="sc">/</span> <span class="fu">nrow</span>(df.rep) <span class="sc">*</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "NA percentage on 'occupation' variable:  5.66014557292466"</code></pre>
</div>
</div>
</section>
<section id="arranging-data" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> Arranging data</h1>
<ul>
<li><code>arrange()</code>: to order a data frame by a column to ascending order
<ul>
<li><code>desc()</code>: to change the order to descending</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span> <span class="fu">arrange</span>( <span class="fu">desc</span>(fnlwgt) ) <span class="sc">%&gt;%</span> .[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
     age workclass     fnlwgt education   
   &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;       
 1    25 Private      1484705 Some-college
 2    39 Private      1455435 Assoc-acdm  
 3    45 Private      1366120 Assoc-voc   
 4    29 Private      1268339 HS-grad     
 5    35 Private      1226583 Bachelors   
 6    30 Private      1184622 Some-college
 7    33 Private      1161363 Some-college
 8    42 Local-gov    1125613 HS-grad     
 9    42 Self-emp-inc 1097453 Bachelors   
10    24 Private      1085515 HS-grad     </code></pre>
</div>
</div>
<p>Also can be useful with <code>group_by()</code>, for example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(marital_status) <span class="sc">%&gt;%</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>( <span class="at">count =</span> <span class="fu">n</span>() ,</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">avg_net_gain =</span> <span class="fu">mean</span>( capital_gain <span class="sc">-</span> capital_loss) ) <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>( <span class="fu">desc</span>(avg_net_gain) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 7 × 3
  marital_status        count avg_net_gain
  &lt;chr&gt;                 &lt;int&gt;        &lt;dbl&gt;
1 Married-civ-spouse    14692        1612.
2 Divorced               4394         668.
3 Married-spouse-absent   397         562.
4 Widowed                 979         495.
5 Separated              1005         487.
6 Married-AF-spouse        23         433.
7 Never-married         10488         328.</code></pre>
</div>
</div>
</section>
<section id="creating-new-variables" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> Creating new variables</h1>
<p>We can create new variables such as splitting a column, creating a calculation, encoding text, applying a custom function…</p>
<ul>
<li><code>separate()</code>: to split a column into two column, by default remove the original column.
<ul>
<li><code>remove=</code> if <code>FALSE</code> to keep the original column</li>
</ul></li>
<li><code>unite()</code>: is the complementary function to separate(), is useful to create a unique identifier.
<ul>
<li><code>sep=</code> to specify the separator of the new column values</li>
<li><code>remove=FALSE</code> to keep the original column</li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span> <span class="fu">separate</span>(target, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"sign"</span>, <span class="st">"amount"</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\\</span><span class="st">b"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> .[,<span class="sc">-</span>(<span class="dv">3</span><span class="sc">:</span><span class="dv">14</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Expected 2 pieces. Additional pieces discarded in 31978 rows [1, 2, 3, 4, 5, 6,
7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, ...].</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
     age workclass sign  amount
   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt; 
 1    45 Private   &gt;     50K   
 2    71 Private   &gt;     50K   
 3    35 Private   &lt;=    50K   
 4    37 Private   &gt;     50K   
 5    59 Private   &gt;     50K   
 6    25 Private   &gt;     50K   
 7    29 Private   &gt;     50K   
 8    19 Private   &lt;=    50K   
 9    59 Local-gov &lt;=    50K   
10    40 Local-gov &lt;=    50K   </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>( sex, race, age, <span class="at">col=</span><span class="st">"description"</span>, <span class="at">sep=</span><span class="st">"_"</span>, <span class="at">remove =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(sex, race, age, description, marital_status) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 5
   sex    race    age description     marital_status    
   &lt;chr&gt;  &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;             
 1 Male   White    46 Male_White_46   Married-civ-spouse
 2 Male   White    26 Male_White_26   Married-civ-spouse
 3 Male   White    42 Male_White_42   Married-civ-spouse
 4 Male   White    37 Male_White_37   Married-civ-spouse
 5 Male   White    33 Male_White_33   Married-civ-spouse
 6 Female White    20 Female_White_20 Never-married     
 7 Male   White    46 Male_White_46   Married-civ-spouse
 8 Female White    22 Female_White_22 Never-married     
 9 Female Black    33 Female_Black_33 Separated         
10 Female White    43 Female_White_43 Divorced          </code></pre>
</div>
</div>
<section id="the-mutate-function" class="level2" data-number="12.1">
<h2 data-number="12.1" class="anchored" data-anchor-id="the-mutate-function"><span class="header-section-number">12.1</span> The <code>mutate()</code> function</h2>
<ul>
<li><code>mutate()</code>: designed to create new variables. Also can be used to modified existing variables using the same column name. Given a data frame, then the new variable name equal to the values.</li>
<li><code>recode()</code>: working as a mapping to transform variables</li>
</ul>
<p>The new variable which you can create could be whatever are in our mind, a custom function, a simple calculation, a vector…</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span> ( <span class="at">total_gain =</span> capital_gain <span class="sc">-</span> capital_loss,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">tax =</span> <span class="fu">ifelse</span>( total_gain <span class="sc">&gt;=</span> <span class="dv">15000</span>,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>                           total_gain <span class="sc">*</span> <span class="fl">0.21</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>                           total_gain <span class="sc">*</span> <span class="fl">0.1</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="fu">select</span>(total_gain, tax, occupation, age) <span class="sc">%&gt;%</span></span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span> ( <span class="fu">desc</span>(tax) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 4
   total_gain   tax occupation        age
        &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1          0     0 Farming-fishing    24
 2          0     0 Adm-clerical       61
 3          0     0 Sales              27
 4          0     0 Craft-repair       29
 5          0     0 Craft-repair       40
 6          0     0 Sales              32
 7          0     0 Prof-specialty     52
 8          0     0 Craft-repair       50
 9          0     0 Prof-specialty     21
10          0     0 Other-service      18</code></pre>
</div>
</div>
<p>Combining <code>mutate()</code> and <code>recode()</code> to transform values, useful for categories:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">over_under =</span> <span class="fu">recode</span> ( target, <span class="st">'&lt;=50'</span><span class="ot">=</span><span class="st">'under'</span>, <span class="st">'&gt;50'</span><span class="ot">=</span><span class="st">'over'</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(target, over_under) <span class="sc">%&gt;%</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   target over_under
   &lt;chr&gt;  &lt;chr&gt;     
 1 &lt;=50K  &lt;=50K     
 2 &lt;=50K  &lt;=50K     
 3 &lt;=50K  &lt;=50K     
 4 &lt;=50K  &lt;=50K     
 5 &lt;=50K  &lt;=50K     
 6 &lt;=50K  &lt;=50K     
 7 &lt;=50K  &lt;=50K     
 8 &lt;=50K  &lt;=50K     
 9 &lt;=50K  &lt;=50K     
10 &gt;50K   &gt;50K      </code></pre>
</div>
</div>
<p>For binning a new variable using <code>mutate()</code> in combination with <code>cut()</code>. To <code>cut()</code> will pass the column, a vector with the intervals, and a vector with the name of that intervals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df.no.na <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">age_avg =</span> <span class="fu">mean</span>(age), </span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">over_under_age_avg =</span> <span class="fu">cut</span>( age,</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">mean</span>(age), <span class="fu">max</span>(age)),</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="fu">c</span>(<span class="st">'Lower than avg'</span>, <span class="st">'Above the avg'</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span> (age, age_avg, over_under_age_avg) <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 3
     age age_avg over_under_age_avg
   &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;             
 1    54    38.6 Above the avg     
 2    25    38.6 Lower than avg    
 3    29    38.6 Lower than avg    
 4    64    38.6 Above the avg     
 5    41    38.6 Above the avg     
 6    36    38.6 Lower than avg    
 7    24    38.6 Lower than avg    
 8    47    38.6 Above the avg     
 9    59    38.6 Above the avg     
10    30    38.6 Lower than avg    </code></pre>
</div>
</div>
</section>
</section>
<section id="joining-datasets" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> Joining datasets</h1>
<ul>
<li><code>left_join()</code></li>
<li><code>right_join()</code>
<ul>
<li><code>keep=</code> if <code>TRUE</code> cause the equal variables from both tables to repeat.</li>
<li><code>by=</code> passing a column to join. It could be passed two column which represent the same values, like <code>by=c('store_id'='id_store')</code></li>
</ul></li>
<li><code>inner_join()</code></li>
<li><code>full_join()</code></li>
<li><code>anti_join()</code></li>
</ul>
<p>If in the previous join functions we don’t pass id= argument, it will determine automatically on which column to join.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>sales <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">date =</span> <span class="fu">c</span>(<span class="st">"2022-01-01"</span>, <span class="st">"2022-01-02"</span>, <span class="st">"2022-01-03"</span>, <span class="st">"2022-01-04"</span>, <span class="st">"2022-01-05"</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_cd=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">product_cd=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">qty=</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">9</span>, <span class="dv">12</span>,<span class="dv">8</span>), </span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">sales=</span> <span class="fu">c</span>(<span class="dv">30</span>, <span class="dv">60</span>, <span class="dv">45</span>, <span class="dv">24</span>, <span class="dv">32</span>)</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>stores <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">store_cd=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">address=</span> <span class="fu">c</span>(<span class="st">'1 main st'</span>, <span class="st">'20 side st'</span>,<span class="st">'19 square blvd'</span>,<span class="st">'101 first st'</span>,<span class="st">'1002 retail ave'</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">city=</span> <span class="fu">c</span>(<span class="st">'Main'</span>, <span class="st">'East'</span>, <span class="st">'West'</span>, <span class="st">'North'</span>, <span class="st">'South'</span>), </span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">open_hours=</span> <span class="fu">c</span>(<span class="st">'7-23'</span>, <span class="st">'7-23'</span>, <span class="st">'9-21'</span>, <span class="st">'9-21'</span>, <span class="st">'9-21'</span>)</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>products <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">product_cd=</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>),</span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">description=</span> <span class="fu">c</span>(<span class="st">'Soft drink'</span>, <span class="st">'Frozen snack'</span>, <span class="st">'Fruit'</span>, <span class="st">'Water'</span>, <span class="st">'Fruit 2'</span>),</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_price=</span> <span class="fu">c</span>(<span class="fl">3.0</span>, <span class="fl">5.0</span>, <span class="fl">5.0</span>, <span class="fl">2.0</span>, <span class="fl">4.0</span>), </span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">unit_measure=</span> <span class="fu">c</span>(<span class="st">'each'</span>, <span class="st">'each'</span>, <span class="st">'kg'</span>, <span class="st">'each'</span>, <span class="st">'kg'</span>)</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="left-join" class="level4" data-number="13.0.0.1">
<h4 data-number="13.0.0.1" class="anchored" data-anchor-id="left-join"><span class="header-section-number">13.0.0.1</span> Left Join</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span> (products[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>], <span class="at">by=</span><span class="st">'product_cd'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        date store_cd product_cd qty sales  description
1 2022-01-01        1          1  10    30   Soft drink
2 2022-01-02        2          2  12    60 Frozen snack
3 2022-01-03        3          3   9    45        Fruit
4 2022-01-04        4          4  12    24        Water
5 2022-01-05        5          5   8    32         &lt;NA&gt;</code></pre>
</div>
</div>
</section>
<section id="right-join" class="level4" data-number="13.0.0.2">
<h4 data-number="13.0.0.2" class="anchored" data-anchor-id="right-join"><span class="header-section-number">13.0.0.2</span> Right Join</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(store_cd, sales) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">right_join</span>(stores, <span class="at">by =</span> <span class="st">'store_cd'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  store_cd sales         address  city open_hours
1        1    30       1 main st  Main       7-23
2        2    60      20 side st  East       7-23
3        3    45  19 square blvd  West       9-21
4        4    24    101 first st North       9-21
5        6    NA 1002 retail ave South       9-21</code></pre>
</div>
</div>
</section>
<section id="full-join" class="level4" data-number="13.0.0.3">
<h4 data-number="13.0.0.3" class="anchored" data-anchor-id="full-join"><span class="header-section-number">13.0.0.3</span> Full Join</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>sales <span class="sc">%&gt;%</span> <span class="fu">full_join</span>(stores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(store_cd)`</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>        date store_cd product_cd qty sales         address  city open_hours
1 2022-01-01        1          1  10    30       1 main st  Main       7-23
2 2022-01-02        2          2  12    60      20 side st  East       7-23
3 2022-01-03        3          3   9    45  19 square blvd  West       9-21
4 2022-01-04        4          4  12    24    101 first st North       9-21
5 2022-01-05        5          5   8    32            &lt;NA&gt;  &lt;NA&gt;       &lt;NA&gt;
6       &lt;NA&gt;        6         NA  NA    NA 1002 retail ave South       9-21</code></pre>
</div>
</div>
</section>
</section>
<section id="reshaping-a-table" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> Reshaping a table</h1>
<p>A data frame in a wide shape is not suitable for machine learning algorithms and for most of the plotting functions. A wide format is when the variable are spread along the rows instead of columns.</p>
<ul>
<li><code>pivot_longer()</code>: given a wide data frame, it will shape it to long format.
<ul>
<li><code>cols=</code> to specify which columns should be reshaped, passing a range (<code>2:6</code>)</li>
<li><code>names_to=</code> passing a string as column name for the columns specified in <code>cols=</code> argument</li>
<li><code>values_to=</code> passing a column name for the column representing the values.</li>
</ul></li>
<li><code>pivot_wider()</code>: given a long data frame, it will shape it to wide format.
<ul>
<li><code>names_from=</code> passing a column name, will take that values to form column names.</li>
<li><code>values_from=</code> passing a column name, will take that values as values.</li>
</ul></li>
</ul>
</section>
<section id="interesting-tidyverse-functions" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Interesting Tidyverse functions</h1>
<p>Using <code>data('mtcars')</code> dataset.</p>
<p>The <code>purrr</code> library contain functions similar to <code>apply()</code> family.</p>
<ul>
<li><code>map()</code>: applies the same function to every element of a vector or list.</li>
</ul>
<p>From <code>dplyr</code> there are functions similar to <code>rbind()</code> and <code>cbind()</code>:</p>
<ul>
<li><code>bind_rows()</code>: the data frames must have the same columns</li>
<li><code>bind_cols()</code>: the data frames must have the same number of observations.</li>
</ul>
<p>Functions used alongside <code>mutate()</code> are cumutalive aggregate functions such as <code>cumsum(), cumprod(), cummean(), cummax(), cume_dist()</code>. This functions expect a variable name.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">'datasets'</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">'mtcars'</span>)</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">cumsum_weight =</span> <span class="fu">cumsum</span>(wt),</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cumpct_weight =</span> <span class="fu">cume_dist</span>(wt),</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">cummean_weight =</span> <span class="fu">cummean</span>(wt) ) <span class="sc">%&gt;%</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(wt, cumsum_weight, cumpct_weight, cummean_weight) <span class="sc">%&gt;%</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(cumpct_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    wt cumsum_weight cumpct_weight cummean_weight
Toyota Corolla   1.835        67.969       0.09375       3.398450
Fiat X1-9        1.935        87.009       0.12500       3.346500
Datsun 710       2.320         7.815       0.21875       2.605000
Mazda RX4        2.620         2.620       0.28125       2.620000
Ferrari Dino     2.770        96.602       0.31250       3.220067
Merc 280C        3.440        34.720       0.62500       3.156364
Dodge Challenger 3.520        73.954       0.68750       3.361545
Maserati Bora    3.570       100.172       0.75000       3.231355
Duster 360       3.570        21.500       0.75000       3.071429
Merc 450SLC      3.780        46.300       0.81250       3.307143</code></pre>
</div>
</div>
<ul>
<li><code>case_when()</code>: also from <code>dplyr.</code> to deal with multiple cases of logical tests.
<ul>
<li>As argument we pass a condition and what will return if it’s <code>TRUE</code>, separated by <code>~</code></li>
</ul></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>( <span class="at">transmission_type =</span> <span class="fu">case_when</span> ( am <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">'automatic'</span>,</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>                                            am <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">'manual'</span> ) ) <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(cyl, mpg, am, transmission_type) <span class="sc">%&gt;%</span></span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   cyl  mpg am transmission_type
Mazda RX4 Wag        6 21.0  1            manual
Maserati Bora        8 15.0  1            manual
Cadillac Fleetwood   8 10.4  0         automatic
Volvo 142E           4 21.4  1            manual
Hornet 4 Drive       6 21.4  0         automatic
AMC Javelin          8 15.2  0         automatic
Merc 280C            6 17.8  0         automatic
Ford Pantera L       8 15.8  1            manual
Fiat 128             4 32.4  1            manual
Pontiac Firebird     8 19.2  0         automatic</code></pre>
</div>
</div>
<section id="ggplot2" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="ggplot2"><span class="header-section-number">15.1</span> <code>ggplot2</code></h2>
<p>As a briefly introduction to ggplot2, it is maybe considered one of the best tools for data visualization.</p>
<p>The syntax is: first, the <code>ggplot()</code> functions receives the data. Going forward we must link the layers using ‘<code>+</code>’. Then we choose the geometry corresponding the graphic type. In geometry we pass <code>aes()</code> with the axis inside like <code>aes(x, y, fill)</code>, and the color, size points and other arguments.</p>
<p>Let’s try a scatterplot with mtcars dataset to view the relationship between ‘miles per gallon’ and ‘horsepower’:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> mtcars) <span class="sc">+</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>( <span class="at">x =</span> hp, <span class="at">y =</span> mpg),</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">'darkblue'</span>, <span class="at">size=</span><span class="dv">4</span>, <span class="at">alpha=</span><span class="fl">0.5</span> ) <span class="sc">+</span></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">"Relationship between HP vs MPG"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="11_transformations_tidyverse_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../to_book/notebooks/99_summary.html" class="pagination-link" aria-label="Base-R Summary">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Base-R Summary</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../to_book/notebooks/12_ExpDatAn.html" class="pagination-link" aria-label="Exploratory Data Analysis">
        <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>