<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Alvaro Manzanas - 5&nbsp; Data into R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../_book-lib-dir/quarto-nav/quarto-nav.js"></script>
<script src="../../_book-lib-dir/clipboard/clipboard.min.js"></script>
<script src="../../_book-lib-dir/quarto-search/autocomplete.umd.js"></script>
<script src="../../_book-lib-dir/quarto-search/fuse.min.js"></script>
<script src="../../_book-lib-dir/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../to_book/notebooks/03_data_handling.html" rel="next">
<link href="../../to_book/notebooks/01_functions_scripts.html" rel="prev">
<script src="../../_book-lib-dir/quarto-html/quarto.js"></script>
<script src="../../_book-lib-dir/quarto-html/popper.min.js"></script>
<script src="../../_book-lib-dir/quarto-html/tippy.umd.min.js"></script>
<script src="../../_book-lib-dir/quarto-html/anchor.min.js"></script>
<link href="../../_book-lib-dir/quarto-html/tippy.css" rel="stylesheet">
<link href="../../_book-lib-dir/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../_book-lib-dir/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../_book-lib-dir/bootstrap/bootstrap.min.js"></script>
<link href="../../_book-lib-dir/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../_book-lib-dir/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../_book-lib-dir/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Alvaro Manzanas</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../portfolio.html"> 
<span class="menu-text">Portfolio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="../../prefacio.html" aria-current="page"> 
<span class="menu-text">Annotations</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-cv" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">CV</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-cv">    
        <li>
    <a class="dropdown-item" href="../../docs/Alvaro Manzanas-CV_es.pdf" target="_blank">
 <span class="dropdown-text">Spanish</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../docs/Alvaro Manzanas-CV_en.pdf" target="_blank">
 <span class="dropdown-text">English</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="http://github.com/almanzanas" target="_blank"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:almanzanas@gmx.com"> <i class="bi bi-bi bi-envelope" role="img" aria-label="e-mail">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://es.linkedin.com/in/alvaromanzanas" target="_blank"> <i class="bi bi-linkedin" role="img" aria-label="Linkedin">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../to_book/notebooks/00_basics_ndata.html">Base R</a></li><li class="breadcrumb-item"><a href="../../to_book/notebooks/02_data_into_r.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data into R</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main tools-wide">
    <a href="http://github.com/almanzanas" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
    <a href="mailto:almanzanas@gmx.com" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bi bi-envelope"></i></a>
    <a href="https://es.linkedin.com/in/alvaromanzanas" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-linkedin"></i></a>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Annotations</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../prefacio.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Annotations</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Base R</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/00_basics_ndata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R: The very basics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/01_functions_scripts.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Functions, scripts and performance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/02_data_into_r.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data into R</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/03_data_handling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Handling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/99_summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Base-R Summary</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data Wrangling and Model</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/11_transformations_tidyverse.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Transformations with Tidyverse</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/12_ExpDatAn.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Exploratory Data Analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/13_enchanced_visualizations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Enchanced Visualizations</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../to_book/notebooks/14_modeling2deploy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Modeling to Deploy</span></span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#getting-data-into-and-out-of-r" id="toc-getting-data-into-and-out-of-r" class="nav-link active" data-scroll-target="#getting-data-into-and-out-of-r"><span class="header-section-number">6</span> Getting Data into and out of R</a>
  <ul class="collapse">
  <li><a href="#tabular-data" id="toc-tabular-data" class="nav-link" data-scroll-target="#tabular-data"><span class="header-section-number">6.1</span> Tabular Data</a>
  <ul class="collapse">
  <li><a href="#files-with-delimiters" id="toc-files-with-delimiters" class="nav-link" data-scroll-target="#files-with-delimiters"><span class="header-section-number">6.1.1</span> Files with Delimiters</a></li>
  <li><a href="#column-classes" id="toc-column-classes" class="nav-link" data-scroll-target="#column-classes"><span class="header-section-number">6.1.2</span> Column Classes</a></li>
  <li><a href="#common-problems" id="toc-common-problems" class="nav-link" data-scroll-target="#common-problems"><span class="header-section-number">6.1.3</span> Common Problems</a></li>
  <li><a href="#when-read.table-go-wrong" id="toc-when-read.table-go-wrong" class="nav-link" data-scroll-target="#when-read.table-go-wrong"><span class="header-section-number">6.1.4</span> When <code>read.table()</code> go wrong</a></li>
  <li><a href="#writing-delimited-files" id="toc-writing-delimited-files" class="nav-link" data-scroll-target="#writing-delimited-files"><span class="header-section-number">6.1.5</span> Writing Delimited Files</a></li>
  <li><a href="#end-of-line-characters" id="toc-end-of-line-characters" class="nav-link" data-scroll-target="#end-of-line-characters"><span class="header-section-number">6.1.6</span> End-of-Line Characters:</a></li>
  </ul></li>
  <li><a href="#non-tabular-data" id="toc-non-tabular-data" class="nav-link" data-scroll-target="#non-tabular-data"><span class="header-section-number">6.2</span> Non-Tabular Data</a>
  <ul class="collapse">
  <li><a href="#different-encodings" id="toc-different-encodings" class="nav-link" data-scroll-target="#different-encodings"><span class="header-section-number">6.2.1</span> Different encodings</a></li>
  <li><a href="#null-character-and-binary-data" id="toc-null-character-and-binary-data" class="nav-link" data-scroll-target="#null-character-and-binary-data"><span class="header-section-number">6.2.2</span> Null Character and Binary Data</a></li>
  </ul></li>
  <li><a href="#reading-data-from-relational-databases" id="toc-reading-data-from-relational-databases" class="nav-link" data-scroll-target="#reading-data-from-relational-databases"><span class="header-section-number">6.3</span> Reading data from Relational Databases</a>
  <ul class="collapse">
  <li><a href="#sql-commands" id="toc-sql-commands" class="nav-link" data-scroll-target="#sql-commands"><span class="header-section-number">6.3.1</span> SQL Commands</a></li>
  </ul></li>
  <li><a href="#large-numbers-of-input-files" id="toc-large-numbers-of-input-files" class="nav-link" data-scroll-target="#large-numbers-of-input-files"><span class="header-section-number">6.4</span> Large Numbers of Input Files</a></li>
  <li><a href="#other-formats" id="toc-other-formats" class="nav-link" data-scroll-target="#other-formats"><span class="header-section-number">6.5</span> Other Formats</a></li>
  <li><a href="#r-data" id="toc-r-data" class="nav-link" data-scroll-target="#r-data"><span class="header-section-number">6.6</span> R Data</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../to_book/notebooks/00_basics_ndata.html">Base R</a></li><li class="breadcrumb-item"><a href="../../to_book/notebooks/02_data_into_r.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data into R</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Data into R</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="getting-data-into-and-out-of-r" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Getting Data into and out of R</h1>
<p>When we gather data for analysis, we have to track it’s history meaning where was acquired, from what source and on what date; this is known as <em>data’s provenance</em>. A place to keep this information can be in the scripts.</p>
<section id="tabular-data" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="tabular-data"><span class="header-section-number">6.1</span> Tabular Data</h2>
<p>One of the most common data we use come in the form of rectangular or tabular data, which is observations in rows and measurements (variables) in columns. Lent’s read tabular data files (ASCII text) into R data frames and to try some approaches when is not working.</p>
<section id="files-with-delimiters" class="level3" data-number="6.1.1">
<h3 data-number="6.1.1" class="anchored" data-anchor-id="files-with-delimiters"><span class="header-section-number">6.1.1</span> Files with Delimiters</h3>
<p>Commonly a observation is represented by a single row which fields are separated by a delimiter such a comma, tab, semicolon, pipe, or exclamation point; and the end of each observation is marked with a end-of-line character which can vary across platforms.</p>
<ul>
<li><code>read.table(), read.csv(), read.delim()</code> : returns a data frame. Each function differs on it’s default settings. Arguments for read.table():
<ul>
<li><code>header=</code> if <code>TRUE</code> will use the first row of the file as column headers.</li>
<li><code>sep=</code> the separator character. The default value is <code>" "</code>.</li>
<li><code>quote=</code> character to be used to surround quotes. By default is set for <code>"</code> and <code>'</code> .</li>
<li><code>comment.char=</code> character which introduce a comment line</li>
<li><code>stringAsFactors=</code> if <code>FALSE</code> will left the character columns as character and <code>TRUE</code> for Factor class.</li>
<li><code>colClasses=</code> expect a vector with the class of each column.</li>
<li><code>na.strings=</code> expect a vector with the indicators of missing value in the input data.</li>
</ul></li>
<li><code>read.csv2()</code> : for European style comma. Use semi-colon as delimiter.</li>
<li><code>read.delim2()</code> : for European style comma.</li>
</ul>
<p>Usually, the quote argument is set to <code>"\""</code> to recognize the double quotation marks because <code>'</code> can be used as apostrophe or turned off with <code>""</code>. Also the comment argument is turned off with <code>""</code> because it is not usual found <code>#</code> in data files and sometimes in fields there are ‘#1’ or similar characters.</p>
</section>
<section id="column-classes" class="level3" data-number="6.1.2">
<h3 data-number="6.1.2" class="anchored" data-anchor-id="column-classes"><span class="header-section-number">6.1.2</span> Column Classes</h3>
<p>We almost always pass <code>stringAsFactor=FALSE</code> when we are reading data, maybe except when we know the data is numeric and pre-cleaned and using <code>colClasses</code>.</p>
<p>The <code>colClasses</code> argument allows to specify the column type for each for the columns. To get an idea what are in the columns we can pass <code>nrow=</code> argument to read a dozen of rows with read.table() and inspect the resulting data frame. It can be specified numeric, character, logical, Date, POSIXct, and also can convert classes as well (see help(read.table)). <code>colClasses</code> recycle it’s elements, to start you can pass “character” and watch what is inside.</p>
</section>
<section id="common-problems" class="level3" data-number="6.1.3">
<h3 data-number="6.1.3" class="anchored" data-anchor-id="common-problems"><span class="header-section-number">6.1.3</span> Common Problems</h3>
<section id="embedded-delimiters" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="embedded-delimiters">Embedded Delimiters</h4>
<p>Problems can arise with simple quote mark, # characters and also a comma as part of some text. This kind of difficulties come often from spreadsheets. If the text with comma is between double quotation marks we can use <code>quote="\""</code>.</p>
</section>
<section id="unknown-missing-value-indicator" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="unknown-missing-value-indicator">Unknown Missing Value Indicator</h4>
<p>By default R expects missing values as NA. A spreadsheet from Excel can have <code>#NULL!, #N/A, #VALUE!</code>, this three could be included in <code>na.strings=</code> argument.</p>
</section>
<section id="empy-or-nearly-empy-filds" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="empy-or-nearly-empy-filds">Empy or Nearly Empy Filds</h4>
<p>Empty fields will be NA values in numeric fields. But in character fields are difficult to perceive.</p>
<p>One of the firsts tasks is to extract the column classes and compare that with what we see:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span> ( <span class="fu">sapply</span>(df, <span class="cf">function</span>(x) <span class="fu">class</span>(x)) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If we know that a column should be numeric (NumID) but it is not, we can tabulate the elements that R is unable to convert:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span> ( df<span class="sc">$</span>NumID[<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(df<span class="sc">$</span>NumID))] )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Examining the set of missing value indicators in the data can be helpful to include that values to <code>na.stings</code> argument in another call to <code>read.table()</code>.</p>
</section>
<section id="blank-lines" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="blank-lines">Blank Lines</h4>
<p>When there are blank rows by default <code>read.table()</code> will skip it. If wee need that the lines from two different files correspond we can pass <code>skip.blank.lines=FALSE</code> argument which will set NA in numeric columns and <code>""</code> in character ones.</p>
</section>
<section id="row-names" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="row-names">Row Names</h4>
<p>By default <code>read.table()</code> will create a row names starting from 1 and up, unless the header has one fewer filed than the rows, in which case R uses the first column as row names. Row names must be unique, if in the data set the first column of row names are not unique we can pass <code>row.names=NULL</code> to create an integer type row names. To specify a column to be the row names (or a vector) we can use <code>row.names=</code> argument.</p>
</section>
</section>
<section id="when-read.table-go-wrong" class="level3" data-number="6.1.4">
<h3 data-number="6.1.4" class="anchored" data-anchor-id="when-read.table-go-wrong"><span class="header-section-number">6.1.4</span> When <code>read.table()</code> go wrong</h3>
<p>If we check the file ‘data/addresses.csv’ we can see is a comma delimited file with headers, then we can specified some arguments:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">comment.char =</span> <span class="st">""</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can check the first line to be sure that are headers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">header =</span> F, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">comment.char =</span> <span class="st">""</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">nrows =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  V1       V2      V3   V4    V5
1 ID LastName Address City State</code></pre>
</div>
</div>
<ul>
<li><code>count.fields()</code> : returns the fields per row.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">count.fields</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>, <span class="at">comment.char =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5 5 6 5 6 5</code></pre>
</div>
</div>
<p>OK, something is wrong in the third and fifth row, let’s see what it is:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">header =</span> F, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">comment.char =</span> <span class="st">""</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">nrows =</span> <span class="dv">1</span>, <span class="at">skip =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  V1     V2           V3       V4       V5 V6
1 11 Macina 401 1st Ave.  Apt 13G New York NY</code></pre>
</div>
</div>
<p>Now we could conclude that in this 3rd row there are embedded commas in V3 corresponding to Address column.</p>
<p>We can force when creating the data frame using the largest number of columns possible by passing <code>fill=TRUE</code> argument. The rows with the last column filled tell us that there are problems in the input data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>add <span class="ot">&lt;-</span> <span class="fu">read.table</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">header =</span> T, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">comment.char =</span> <span class="st">""</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>, <span class="at">fill =</span> T)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ID          LastName       Address     City State
001 O'Higgins      48 Grant Rd.    Des Moines       IA      
011    Macina      401 1st Ave.       Apt 13G New York    NY
242    Roeder    71 Quebec Ave.   E. Thetford       VT      
146  Stephens   1234 Smythe St.            #5  Detroit    MI
241  Ishikawa 986 OceanView Dr. Pacific Grove       CA      </code></pre>
</div>
</div>
<p>The IDs have become row names because there are a less field in headers. In the case the ID was duplicated we have to pass <code>row.names=NULL</code> argument.</p>
<p>To continue, we are going to identify the bad formatted rows, then we’re going to <code>paste()</code> the columns 2 and 3 from that rows which had embedded comma, and to finish changing the positions of columns 4-5 to 3-4.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector with logical values:</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fixc <span class="ot">&lt;-</span> add<span class="sc">$</span>State <span class="sc">!=</span> <span class="st">""</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Paste column 2 and 3 from that rows</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>add[fixc, <span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">paste</span> (add[fixc, <span class="dv">2</span>], add[fixc, <span class="dv">3</span>])</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Changing the order</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>add[fixc, <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>] <span class="ot">&lt;-</span> add[fixc, <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>]</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>add</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           ID              LastName       Address City State
001 O'Higgins          48 Grant Rd.    Des Moines   IA      
011    Macina 401 1st Ave.  Apt 13G      New York   NY    NY
242    Roeder        71 Quebec Ave.   E. Thetford   VT      
146  Stephens   1234 Smythe St.  #5       Detroit   MI    MI
241  Ishikawa     986 OceanView Dr. Pacific Grove   CA      </code></pre>
</div>
</div>
<p>Our last step will be to delete the last column after saving the column names. And remove the variables that we won’t need any more.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Saving column names and deleting State column</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>mycols <span class="ot">&lt;-</span> <span class="fu">colnames</span> (add)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>add<span class="sc">$</span>State <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="co"># ID column will take the values of the previus rownames, then assing colnames</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>add <span class="ot">&lt;-</span> <span class="fu">data.frame</span> (<span class="at">ID =</span> <span class="fu">rownames</span> (add), add)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span> (add) <span class="ot">&lt;-</span> mycols</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace old rownames:</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span> (add) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Removing objects:</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span> (fixc, mycols)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>add</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID  LastName               Address          City State
1 001 O'Higgins          48 Grant Rd.    Des Moines    IA
2 011    Macina 401 1st Ave.  Apt 13G      New York    NY
3 242    Roeder        71 Quebec Ave.   E. Thetford    VT
4 146  Stephens   1234 Smythe St.  #5       Detroit    MI
5 241  Ishikawa     986 OceanView Dr. Pacific Grove    CA</code></pre>
</div>
</div>
<section id="using-scan" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="using-scan">Using Scan</h4>
<p>Given the previous data set, let’s explore the content of that file with <code>scan()</code>, a general-purpose data input tool.</p>
<ul>
<li><code>sep="\"</code> : to read entire lines</li>
<li><code>what=character()</code> or <code>what=""</code> : by default scan() expect numbers, so we specify that it will encounter characters.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>add.scan <span class="ot">&lt;-</span> <span class="fu">scan</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">what =</span> <span class="fu">character</span>(), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>                  <span class="at">quote =</span> <span class="st">""</span>, <span class="at">comment.char =</span> <span class="st">""</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ID,LastName,Address,City,State"                 
[2] "001,O'Higgins,48 Grant Rd.,Des Moines,IA"       
[3] "011,Macina,401 1st Ave., Apt 13G,New York,NY"   
[4] "242,Roeder,71 Quebec Ave.,E. Thetford,VT"       
[5] "146,Stephens,1234 Smythe St., #5,Detroit,MI"    
[6] "241,Ishikawa,986 OceanView Dr.,Pacific Grove,CA"</code></pre>
</div>
</div>
<p>We can fix it replacing the third comma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># locating all the commas:</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>commas <span class="ot">&lt;-</span> <span class="fu">gregexpr</span> (<span class="st">","</span>, add.scan)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting long rows:</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>comma<span class="fl">.5</span> <span class="ot">&lt;-</span> <span class="fu">lengths</span> (commas) <span class="sc">==</span> <span class="dv">5</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Locating the third comma:</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>comma.gone <span class="ot">&lt;-</span> <span class="fu">sapply</span> (commas[comma<span class="fl">.5</span>], <span class="cf">function</span>(x) x[<span class="dv">3</span>])</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replacing comma for semi-colon:</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a><span class="fu">substring</span> (add.scan[comma<span class="fl">.5</span>], comma.gone, comma.gone) <span class="ot">&lt;-</span> <span class="st">";"</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>add.scan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ID,LastName,Address,City,State"                 
[2] "001,O'Higgins,48 Grant Rd.,Des Moines,IA"       
[3] "011,Macina,401 1st Ave.; Apt 13G,New York,NY"   
[4] "242,Roeder,71 Quebec Ave.,E. Thetford,VT"       
[5] "146,Stephens,1234 Smythe St.; #5,Detroit,MI"    
[6] "241,Ishikawa,986 OceanView Dr.,Pacific Grove,CA"</code></pre>
</div>
</div>
<p>The next step will be <code>read.table()</code> from text, also we can save our progress with <code>write.table()</code> in case we will use it again o for other users.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">read.table</span> (<span class="at">text =</span> add.scan, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">sep =</span> <span class="st">","</span>, <span class="at">quote =</span> <span class="st">""</span>,</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">comment =</span> <span class="st">""</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">colClasses =</span> <span class="fu">c</span>(<span class="at">ID =</span> <span class="st">"character"</span>) )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   ID  LastName               Address          City State
1 001 O'Higgins          48 Grant Rd.    Des Moines    IA
2 011    Macina 401 1st Ave.; Apt 13G      New York    NY
3 242    Roeder        71 Quebec Ave.   E. Thetford    VT
4 146  Stephens   1234 Smythe St.; #5       Detroit    MI
5 241  Ishikawa     986 OceanView Dr. Pacific Grove    CA</code></pre>
</div>
</div>
</section>
</section>
<section id="writing-delimited-files" class="level3" data-number="6.1.5">
<h3 data-number="6.1.5" class="anchored" data-anchor-id="writing-delimited-files"><span class="header-section-number">6.1.5</span> Writing Delimited Files</h3>
<p>To perform this task we use <code>write.table(), write.csv(), write.csv2()</code> and it’s analogs. Also with <code>write.table()</code> can be passed a matrix. Saving a file with <code>write.table()</code> generally it be passed <code>sep=</code> argument specifying the delimiter, <code>quote=FALSE</code> to not save the quotes in character fields but sometimes it is necessary for numbers with leading zeros or embedded commas. Rarely we want to save the row names, then with row.names=FALSE we omit them.</p>
<section id="fixed-width-files" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="fixed-width-files">Fixed width Files</h4>
<p>A fixed-width file have a specific number of character for each field, for example, ID have 4 characters, name 15, account 12… For this files we use <code>read.fwf()</code> that has many of the same arguments as <code>read.table()</code>, and the most important is <code>widths=</code> which expect an integer vector with the lengths of the fields.</p>
</section>
</section>
<section id="end-of-line-characters" class="level3" data-number="6.1.6">
<h3 data-number="6.1.6" class="anchored" data-anchor-id="end-of-line-characters"><span class="header-section-number">6.1.6</span> End-of-Line Characters:</h3>
<p>Windows has <code>\r</code> and <code>\n</code>. OS X and Linux only <code>\n</code>. Depending the platform and application we should be aware, but R is flexible with <code>read.table()</code> and <code>scan()</code> functions which permits some flexibility.</p>
</section>
</section>
<section id="non-tabular-data" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="non-tabular-data"><span class="header-section-number">6.2</span> Non-Tabular Data</h2>
<p>Sometimes files are too big to fit into the main memory, then we will need some techniques to work with that files. If we need a subset of records, we can filter the data set without reading it all into memory. On the other hand, there are files not suitable for <code>read.table()</code> like JSON and XML, or binary data.</p>
<ul>
<li><code>file()</code> and relatives : return a connection object that stores all the information that R needs.
<ul>
<li><code>open=</code> whether the file is to be read, written or append to (“r”, “w”, “a”). It can be passed with ‘+’ to read and write, and adding t or b for text or binary modes. <code>open="a+b"</code> opens a binary file for reading and appending.</li>
</ul></li>
<li><code>close()</code> : to close a connection. Is a good practice to close the connection when we are finish with it.</li>
</ul>
<p>The function <code>readLines()</code> opens the file, reads as many lines we want and closes the file. The argument <code>n=</code> mean number of lines and <code>n=-1</code> for all lines. We can use <code>readLines()</code> over a connection to consecutively read lines from that connected file because will remain open. The analogous function is <code>writeLines()</code> and <code>writeChar()</code> which adds a null character after it’s end-of-line character but using <code>eos=NULL</code> argument the string is written without terminator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">n =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ID,LastName,Address,City,State"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>con.add <span class="ot">&lt;-</span> <span class="fu">file</span> (<span class="st">"../data/addresses.csv"</span>, <span class="at">open =</span> <span class="st">"r"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span> (con.add, <span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "ID,LastName,Address,City,State"          
[2] "001,O'Higgins,48 Grant Rd.,Des Moines,IA"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">readLines</span> (con.add, <span class="at">n =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "011,Macina,401 1st Ave., Apt 13G,New York,NY"
[2] "242,Roeder,71 Quebec Ave.,E. Thetford,VT"    </code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">close</span> (con.add)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When a file is open R maintains a ‘pointer’ that describes the location, one for read and one for write. With <code>seek()</code> function we can get the current location of the file, and passing where= argument we can choose a position which is useful to jump to a prespecified position. But help tell us that <code>seek()</code> on windows is discouraged. Finally, <code>flush()</code> function can be used after a file output to ensure the write on disk operation.</p>
<section id="different-encodings" class="level3" data-number="6.2.1">
<h3 data-number="6.2.1" class="anchored" data-anchor-id="different-encodings"><span class="header-section-number">6.2.1</span> Different encodings</h3>
<p>For most of the previous functions (read.table or scan) we can pass <code>fileEncoding=</code> argument to specify the encoding in the file we are going to work with, and <code>encoding=</code> argument specifies the encoding of the R object that contains the data.</p>
<p>To write on file we have to be certain what encoding have and pass to <code>file()</code> the <code>encoding=</code> argument and read using <code>readLines()</code> and again <code>enconding="UTF-8"</code>. In the same way to write we use file to open a connection selecting the encoding and passing <code>useBytes=TRUE</code> argument which prevent R to convert encoded strings back to the native encoding before writing.</p>
</section>
<section id="null-character-and-binary-data" class="level3" data-number="6.2.2">
<h3 data-number="6.2.2" class="anchored" data-anchor-id="null-character-and-binary-data"><span class="header-section-number">6.2.2</span> Null Character and Binary Data</h3>
<p>In hexadecimal are represented as <code>00</code> or <code>0x00</code> by R, that’s not R’s NULL value. By default with <code>scan()</code> and <code>read.table()</code> will stop reading a NULL character and it will continue with the next field. The argument <code>skipNul=TRUE</code> allows to skip over NULL which is a safe choice for delimited data. For intended NULL in text we have to read the file as binary.</p>
<ul>
<li><code>readBin()</code> : to read binary data. Requires the number of bytes to read because it won’t recognize the end-of-line characters. It will return a vector with class <code>raw</code>.</li>
</ul>
<p>Once read the file, we can write it back with <code>writeBin()</code> or convert it into data.</p>
<ul>
<li><code>rawToChar()</code> : when we know that the raw data represents text, unless there are embedded nulls.</li>
</ul>
<p>With a raw vector we can look for NULLs and replace it with space or other character that we want:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>vec[vec <span class="sc">==</span> <span class="dv">0x00</span>] <span class="ot">&lt;-</span> <span class="fu">as.raw</span>(<span class="dv">0x20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>If all the previous steps has gone well, after write the data back or converted to text we can use <code>read.fwf()</code> or <code>readLines()</code>.</p>
</section>
</section>
<section id="reading-data-from-relational-databases" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="reading-data-from-relational-databases"><span class="header-section-number">6.3</span> Reading data from Relational Databases</h2>
<p>It is not necessary to load all the data into R, if the data tables are small, it doesn’t matter but with large amount of data it is better using the database as much as possible. We will need the package <code>RODBC</code> to be installed into R.</p>
<p>To use <code>odbcConnect()</code> we need to have installed ODBC drivers from Microsoft, and then open de application and configure a new DSN which will be the first argument. This DSN contain the database, language and additional configurations. It will create a handle to be used with other commands. The alternative is <code>odbcDiverConnect()</code> which provide us more flexibility; the first argument is a connection string with ODBC configuration.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>connection <span class="ot">&lt;-</span> <span class="fu">odbcConnect</span>(<span class="st">"SQL2022"</span>, <span class="at">uid=</span><span class="st">"rstats"</span>, <span class="at">pwd=</span><span class="st">"P@ssw0rd"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>adv.tab <span class="ot">&lt;-</span> <span class="fu">sqlTables</span>(connection, <span class="at">tableType =</span> <span class="st">"TABLE"</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>adv.tab[<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqlColumns</span>(connection, <span class="st">"Employee"</span>)[<span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">4</span><span class="sc">:</span><span class="fu">ncol</span>(<span class="fu">sqlColumns</span>(connection, <span class="st">"Employee"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Once we are done with the connection (handle) it is recommended to close it with <code>close(connection)</code> or <code>odbcClose(connection)</code></p>
<section id="sql-commands" class="level3" data-number="6.3.1">
<h3 data-number="6.3.1" class="anchored" data-anchor-id="sql-commands"><span class="header-section-number">6.3.1</span> SQL Commands</h3>
<p>We are going to interact with the database using ODBC functions such as <code>sqlQuery()</code> passing a character string.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>emp <span class="ot">&lt;-</span> <span class="fu">sqlQuery</span> (connection, <span class="st">"</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="st">                 SELECT * FROM HumanResources.Employee</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="st">                 "</span>)</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>s10 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(emp), <span class="dv">10</span>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>emp[s10,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>emp.mal <span class="ot">&lt;-</span> <span class="fu">sqlQuery</span> (connection, <span class="st">"</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="st">                    SELECT BusinessEntityID, LoginID, VacationHours, SickLeaveHours</span></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="st">                    FROM HumanResources.Employee</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="st">                    WHERE Gender = 'M'</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="st">                    "</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>s10 <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(emp.mal), <span class="dv">10</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>emp.mal[s10,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>sqlQuery()</code> function supports simple arithmetic operations such as count, max or min, combine columns arithmetically, logarithms, aggregate data into groups…</p>
<section id="joining-tables" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="joining-tables">Joining Tables</h4>
<p>Join in SQL is like <code>merge()</code> function in R. It is to match up two tables according to the value of a column in each one.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>emp.sales <span class="ot">&lt;-</span> <span class="fu">sqlQuery</span> (connection, <span class="st">"</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="st">                    SELECT *</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="st">                    FROM Sales.SalesPerson</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="st">                    LEFT JOIN HumanResources.Employee </span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="st">                    ON Sales.SalesPerson.BusinessEntityID = HumanResources.Employee.BusinessEntityID</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="st">                    "</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a><span class="co"># s10 &lt;- sample(nrow(emp.sales), 10)</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>emp.sales</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="results-in-pieces" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="results-in-pieces">Results in Pieces</h4>
<p>When we call to <code>sqlQuery()</code> performs two tasks, first it sends the query and then fetch the results. If we are going to work with very large tables we can do this tasks separately.</p>
<ul>
<li><code>sqlFetch()</code> : get the first batch with a given number of rows. Subsequent calls should be made to <code>sqlFetchMore()</code> with <code>max=</code> argument.</li>
</ul>
<p>Also, calling <code>sqlQuery()</code> passing <code>max=</code> for complicated queries, we can follow it with <code>sqlGetResults()</code> and <code>rows_at_time=</code> argument with an integer between 1 and 1024 (number of rows to fetch at a time).</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqlFetch</span>(connection, <span class="st">"Sales.Customer"</span>, <span class="at">max =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqlFetchMore</span>(connection, <span class="at">max =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="sqlite" class="level4 unnumbered">
<h4 class="unnumbered anchored" data-anchor-id="sqlite">SQLite</h4>
<p>SQLite is a ‘serverless’ database which data is stored in one large file well suited to smaller applications. The <code>RSQLite</code> package connects R to SQLite databases. Some useful function are:</p>
<ul>
<li><code>dbConnect()</code> : passing as first argument <code>SQLite()</code> and the second <code>dbname=</code> argument is the name of the file containing the data. Returns a handle for other functions.</li>
<li><code>dbListTables()</code> : list the tables. The first argument can be the handle.</li>
<li><code>dbListFields()</code> : return the fields (columns) in a table.</li>
<li><code>dbGetQuery()</code> : analogous to <code>sqlQuery()</code>, executes a query and returns the data.</li>
<li><code>dbSendQuery()</code> and <code>dbFetch()</code> : create a query and receive the data. <code>dbSendQuery()</code> does not returns data, it prepares the database to return data with <code>dbFetch()</code>.</li>
</ul>
</section>
</section>
</section>
<section id="large-numbers-of-input-files" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="large-numbers-of-input-files"><span class="header-section-number">6.4</span> Large Numbers of Input Files</h2>
<p>As Data Scientists will have to perform tasks in directories and files which sometimes there are thousands of them. For example, unzipping files and using its content.</p>
<ul>
<li><code>list.files()</code> : list files matching a pattern (regular expression).</li>
<li><code>unzip()</code> : to unzip zipped files.</li>
<li>Other file. family functions such as <code>file.copy(), file.remove(), file.rename()</code>…</li>
</ul>
<p>The datasets used for this example are from: https://github.com/wesm/pydata-book/tree/3rd-edition/datasets/babynames</p>
<p>To continue we are going to unzip the babynames files from 1950s to 2000s and load the comma separated data. First we need to know what are their names and the names of the files inside each file.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># listing files corresponding with babynames data</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../"</span> , </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">pattern =</span> <span class="st">"^babynames.*</span><span class="sc">\\</span><span class="st">.zip$"</span>,</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> F)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "data/babynames/babynames-1950.zip" "data/babynames/babynames-1960.zip"
[3] "data/babynames/babynames-1970.zip" "data/babynames/babynames-1980.zip"
[5] "data/babynames/babynames-1990.zip" "data/babynames/babynames-2000.zip"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exploring one .zip file</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">unzip</span>(<span class="st">"../data/babynames/babynames-1950.zip"</span>, <span class="at">list =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Name Length                Date
1  yob1951.txt 135349 2024-08-27 17:19:00
2  yob1952.txt 137658 2024-08-27 17:19:00
3  yob1953.txt 140015 2024-08-27 17:19:00
4  yob1954.txt 141564 2024-08-27 17:19:00
5  yob1955.txt 143552 2024-08-27 17:19:00
6  yob1956.txt 146612 2024-08-27 17:19:00
7  yob1957.txt 149179 2024-08-27 17:19:00
8  yob1958.txt 148618 2024-08-27 17:19:00
9  yob1959.txt 151965 2024-08-27 17:19:00
10 yob1960.txt 154001 2024-08-27 17:19:00</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Listing .zip files</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>zipfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../"</span> , </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">"^babynames.*</span><span class="sc">\\</span><span class="st">.zip$"</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> T)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Unzip every file</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (f <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(zipfiles)) {</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unzip</span> (zipfiles[f])</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Listing .txt files </span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>txtfiles <span class="ot">&lt;-</span> <span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"../"</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">pattern =</span> <span class="st">"^yob.*</span><span class="sc">\\</span><span class="st">.txt$"</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">recursive =</span> <span class="cn">TRUE</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Extracting names and years</span></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a>txtnames <span class="ot">&lt;-</span> <span class="fu">sub</span> (<span class="st">"../notebooks/"</span>, <span class="st">""</span>, txtfiles)</span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>yr <span class="ot">&lt;-</span> <span class="fu">substring</span> (txtnames, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a><span class="co"># creating a data frame with every file using year as a column</span></span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span> (txtfiles) ) {</span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>    dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span> (<span class="at">Year =</span> yr[i], <span class="fu">read.csv</span> (txtfiles[i], </span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">header =</span> <span class="cn">FALSE</span>, </span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>                                               <span class="at">stringsAsFactor=</span><span class="cn">FALSE</span>))</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="fu">rbind</span> (result, dat)</span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>s10 <span class="ot">&lt;-</span> <span class="fu">sample</span> (<span class="fu">nrow</span>(result), <span class="dv">10</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>result[s10,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Year       V1 V2  V3
879278 2000 Nikolaus  M  72
140350 1963   Gracia  F  12
206620 1968   Garret  M  89
678754 1993  Shareen  F  14
530374 1987    Paola  F 192
659955 1992   Tanisa  F   6
729068 1995   Lottie  F  20
303412 1975   George  F  54
416124 1981   Dereka  F  13
247257 1971  Suzetta  F   6</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(result) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Year"</span>, <span class="st">"Name"</span>, <span class="st">"Sex"</span>, <span class="st">"Count"</span>)</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cleaning exported files</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>rem <span class="ot">&lt;-</span> <span class="fu">file.remove</span>(txtfiles)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(rem)</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>result[s10,]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Year     Name Sex Count
879278 2000 Nikolaus   M    72
140350 1963   Gracia   F    12
206620 1968   Garret   M    89
678754 1993  Shareen   F    14
530374 1987    Paola   F   192
659955 1992   Tanisa   F     6
729068 1995   Lottie   F    20
303412 1975   George   F    54
416124 1981   Dereka   F    13
247257 1971  Suzetta   F     6</code></pre>
</div>
</div>
</section>
<section id="other-formats" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="other-formats"><span class="header-section-number">6.5</span> Other Formats</h2>
<p>The <strong>clipboard</strong> can be used for moving text between programs. R sees the clipboard as a file named “clipboard” which can be used with <code>read.table("clipboard")</code> or <code>write.table(df, "clipboard")</code> and then paste it into a spreadsheet. For MAC and Linux there are different approaches.</p>
<p>From <strong>spreadsheets</strong> like Microsoft Excel with format .xls or .xlsx we can use <code>read.xls()</code> or <code>read.xlsx()</code> functions from <code>gdata</code> package. The spreadsheets have to be rectangular as a data frame must be.</p>
<p>Also we can acquire a <strong>web</strong> page with <code>getURI()</code> function of the <code>RCurl</code> package which will return a character vector of length 1. For HTML tables <code>readHTMLTable()</code> function from <code>XML</code> package will be our usual tool.</p>
<p>Working with <strong>XML</strong> using functions provided by <code>XML</code> package we can use <code>xmlTreeParse()</code> for read in a file and returns a tree-like object of class <code>XMLDocument</code>. This object acts like an R list where we can use its names to extract fields. The <code>xmlValue()</code> function converts the list element into text. Other approach is to use <code>xmlParse()</code> function and then <code>xpathSApply()</code> to search with RE or basic search resulting a list of object of class <code>xmlNode.</code></p>
<p>For <strong>JSON</strong> can be used <code>rjson</code>, <code>RJSONIO</code> and <code>jsonlite</code> packages which read and write JSON objects. If we have a file containing a whole set of JSON messages, one per line we can use <code>scan(..., sep="\n", what="")</code> and apply a conversion <code>fromJSON()</code> to each message.</p>
<p>To finish, to extract data using a <strong>REST API</strong> can be used <code>RCurl</code> and <code>httr</code> packages. For other statistical packages such as SAS, SPSS or Minitab the recommended package is <code>foreign.</code></p>
</section>
<section id="r-data" class="level2" data-number="6.6">
<h2 data-number="6.6" class="anchored" data-anchor-id="r-data"><span class="header-section-number">6.6</span> R Data</h2>
<ul>
<li><code>save()</code> : the output is a file with the objects stored in.</li>
<li><code>load()</code> : restore all the objects stored on disk by <code>save()</code> (can overwrite objects)</li>
<li><code>saveRSD()</code> : take an object and process a disk file with its data and attributes.</li>
<li><code>readRDS()</code> : returns the object just like was saved.</li>
<li><code>save.image()</code> : to save objects into the workspace, and by default creates a <code>.RData</code> file.</li>
<li><code>attach()</code> : to add an R data file to the search path (where R look for objects)</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../to_book/notebooks/01_functions_scripts.html" class="pagination-link" aria-label="Functions, scripts and performance">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Functions, scripts and performance</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../to_book/notebooks/03_data_handling.html" class="pagination-link" aria-label="Data Handling">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Data Handling</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>